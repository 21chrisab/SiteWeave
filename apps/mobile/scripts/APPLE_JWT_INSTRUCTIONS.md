# Generate Apple Sign In JWT for Supabase

Supabase requires a JWT (JSON Web Token) for Apple Sign In configuration, not the raw .p8 file.

## Prerequisites

You need:
1. ‚úÖ **Private Key (.p8 file)**: `AuthKey_CKTKTSC6SB.p8` (you have this)
2. ‚úÖ **Key ID**: `CKTKTSC6SB` (from filename)
3. ‚è≥ **Team ID**: From Apple Developer account
4. ‚è≥ **Services ID**: From Apple Developer account

## Step 1: Get Your Team ID

1. Go to https://developer.apple.com/account
2. Click **Membership** in the left sidebar
3. Copy your **Team ID** (looks like: `ABC123DEF4`)

## Step 2: Get Your Services ID

1. Go to https://developer.apple.com/account/resources/identifiers/list
2. Click **Services IDs** in the left sidebar
3. Find the Services ID you created for Sign in with Apple
4. Copy the **Identifier** (looks like: `com.siteweave.mobile.signin`)

## Step 3: Update the Script

1. Open `apps/mobile/scripts/generate-apple-jwt.js`
2. Update these values in the `CONFIG` object:
   ```javascript
   teamId: 'YOUR_TEAM_ID_HERE',        // Replace with your Team ID
   servicesId: 'YOUR_SERVICES_ID_HERE', // Replace with your Services ID
   ```
3. Verify the `privateKeyPath` points to your .p8 file location

## Step 4: Run the Script

```bash
cd apps/mobile
node scripts/generate-apple-jwt.js
```

The script will:
- Read your .p8 private key
- Generate a JWT token signed with your key
- Display the JWT token to copy

## Step 5: Configure in Supabase

1. Go to **Supabase Dashboard** ‚Üí **Authentication** ‚Üí **Providers**
2. Find **Apple** and toggle it **ON**
3. Fill in:
   - **Services ID**: Your Services ID (from Step 2)
   - **Secret Key**: Paste the JWT token generated by the script
   - **Team ID**: Your Team ID (from Step 1)
   - **Key ID**: `CKTKTSC6SB` (already set)
4. Click **Save**

## Important Notes

- ‚ö†Ô∏è The JWT expires in **1 year**. You'll need to regenerate it before expiration.
- üîí Keep your .p8 file secure and never commit it to git
- ‚úÖ The JWT is what Supabase needs, not the raw .p8 file content

## Troubleshooting

**Error: "Private key file not found"**
- Update `privateKeyPath` in the script to point to your .p8 file location

**Error: "PEM" or key format error**
- Make sure your .p8 file is in PEM format (it should start with `-----BEGIN PRIVATE KEY-----`)

**Error: "Invalid signature"**
- Double-check your Team ID and Services ID are correct
- Make sure the Key ID matches your .p8 filename

## Quick Reference

From your file:
- **Key ID**: `CKTKTSC6SB` ‚úÖ
- **Private Key**: `AuthKey_CKTKTSC6SB.p8` ‚úÖ

You need:
- **Team ID**: Get from Apple Developer ‚Üí Membership
- **Services ID**: Get from Apple Developer ‚Üí Identifiers ‚Üí Services IDs

